---
title: Pods - Basics
geekdocNav: true
geekdocAlign: left
geekdocAnchor: false
tags:
    - minikube
    - kubectl
---

{{< hint type="note" title="Objective">}}
* [x] What a Kubernetes `Pod` is
* [x] Run your first pod (hello world)
* [x] Learn `kubectl` commands to interact with pods
{{< /hint >}}

{{< toc >}}

# :dizzy: What is a Kubernetes `Pod` ?

> Pods are the smallest deployable units of computing that you can create and manage in Kubernetes.

A Pod is bound to the lifecycle of your container. When a container dies the pod dies as well.

In most common scenarios, **a pod runs a single container**, but you can wrap multiple containers in a single pod. The primary reason that Pods can have multiple containers is to support helper applications that assist a primary application. they usually interact with each others through a shared file system or through the loopback network interface, localhost (eg. A local webserver that along with an helper program that pulls from Git for new updates).

# :rocket: Run your hello-world pod

As mentioned earlier `kubectl` is going to be your best friend moving forward. We will leverage it to generate the specs of `pod`

* Run the following command:

{{< highlight "sh" >}}
kubectl run hello-world --image=nginx:latest --port=80 -o yaml --dry-run=client
{{< /highlight >}}

* Let's dissect what was generated by this command:

{{< columns >}}

{{< include file="static/workshop/getting-started/hello-world/00-pods.yaml" language="yaml"  options="linenos=table,hl_lines=1-3 7 8 10,linenostart=1" >}}

<--->

{{< hint info >}}
See the [official documentation](https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/) for more details
{{< /hint >}}

| Field        | Description |
| ------------ | ----------- |
| `apiVersion` | Which version of the Kubernetes API you're using to create this object           |
| `kind` | What kind of object you want to create            |
| `metadata` | Data that helps uniquely identify the object, including a name string            |
| `spec` | What state you desire for the object            |

:point_up: You also notice the `--image` argument from the above command defined the `.spec.containers[0].image` section and similarly for `--port` which filled in `.spec.containers[0].ports[0].containerPort`.

{{< /columns >}}

* Nothing happened with the command above as we ran it with `--dry-run=client`, let's remove it and rerun the command

```yaml
kubectl run hello-world --image=nginx:latest -o yaml
```
{{< expand "Terminal Output" >}}
{{< include file="static/workshop/getting-started/hello-world/00-pods-out.yaml" language="yaml"  options="linenos=table,linenostart=1" >}}
{{</ expand >}}

* Great you just kicked off your first `pod` on Kubernetes :tada: ! But where did it go ? Let's use `kubectl` to list all pods running in the current `namespace`. Wait what `namespace` are you currently in :thinking_face: ?

* Run `kubens` to find out, `default` namespace should be selected, if it's not the case run `kubens <namespace>` to switch to this namespace:
```sh {linenos=table,hl_lines=[3],linenostart=1}
$ kubens

default
kube-node-lease
kube-public
kube-system
```

* Now query the Kubernetes API to retrieve the list of running pods (Your pod might be in pending state while it's pulling the image, re-iterate this command until you see it turn to `Running`):

```sh
kubectl get pod
# [or] kubectl get pods (singular or plural does not matter for Kubernetes API :winking_face:)

NAME          READY   STATUS    RESTARTS   AGE
hello-world   1/1     Running   0          13m
```

* Great, now it's time to connect to this Nginx webserver but how ? No problems here, `kubectl` provides a command to do [port forwarding](https://en.wikipedia.org/wiki/Port_forwarding#:~:text=In%20computer%20networking%2C%20port%20forwarding,as%20a%20router%20or%20firewall.) between the Kubernetes API server and Kubernetes establishes a single HTTP connection between your localhost and the resource running on your cluster.

{{< hint type="tip" >}}
You can use `kubectl port-forward` to debug an application that is not fronted by a load balancer or not exposed on the network.

`kubectl port-forward  pod/<pod-name> <port-on-laptop>:<port-on-pod>`
{{< /hint >}}

```sh
❯ kubectl port-forward pod/hello-world 8080:80

Forwarding from 127.0.0.1:8080 -> 80
Forwarding from [::1]:8080 -> 80
```

{{< hint "note" >}}
`kubectl port-forward` does not return. To continue with this exercise, you will need to open another terminal.
{{< /hint >}}

* Now go ahead and visit {{< a_blank "localhost:8080" "http://localhost:8080" >}} in your browser

{{< hint type="tip" >}}
You can inspect the logs of your running pod `kubectl logs -f <pod-name>`

Refresh your browser page multiple times to see logs flowing in your terminal
{{< /hint >}}

{{< figure src="/excalidraw/00-pod-hello-world.excalidraw.png" >}}


## Imperative vs Declarative

Now what's next ? Well while it can be convenient to kick off a pod like you did above, it is not really convenient to share with peers or commit into a source control  repository.

The previous exercise used an `imperative` command to submit the instruction to the Kubernetes API. There is an other way (and preferred way) that is based on a declarative style.

* Let's save the previously created pod statement that was generated earlier {{< a_blank "Click to download `00-pods.yaml`" "/workshop/getting-started/hello-world/00-pods.yaml" >}} or copy paste the content below:

{{< include file="static/workshop/getting-started/hello-world/00-pods.yaml" language="yaml"  options="linenos=table,linenostart=1" >}}

* You can now use `kubectl apply -f <filename>.yaml` to `PATCH` the resource and sync the running resource to propagate updates to the running object

```sh
❯ kubectl apply -f 00-pods.yaml

Warning: resource pods/hello-world is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.

pod/hello-world configured

```

* Obviously the change above did not make any updates as we did not change anything compared to the original statement ran with `kubectl create`. Let's change the `image` to see what's going on:

> :point_right: Change the image to `lowess/nginx-rainbow:yellow` and apply the change

{{< hint type="caution" >}}
Please note this action will instruct kubernetes to recreate the container and thus may break your port forward command. Don't hesitate to kill and rerun your tunnel command: `kubectl port-forward pod/hello-world 8080:80`
{{< /hint >}}

{{< hint type="note" >}}
Modern web browsers have an excessive tendency to cache everything !!! Make sure to **force the page to load without using the cache**:
* Linux: `Maj + Ctrl+ R`
* MacOs: `⌘ + Maj + R`

{{< /hint >}}

* :rainbow: Wow better with colors right :rainbow: ? What happened here ?

    * You placed a new intent and instructed the Kubernetes API that `hello-world` pod should now be running the docker image `lowess/nginx-rainbow:yellow`

    * Kubernetes scheduler got informed about this change and went ahead and executed the statement by destroying the `hello-world` pod so that it can be restarted with new image.

    * The new pod becomes up and running and your instruction is now 100% fulfilled. Your infrastructure is now back in sync with your intentions.

* Let's run a few more commands to inspect how the pod got replaced and make sure it is set with the new image:

```sh
kubectl describe pod hello-world
```
{{< expand "Terminal Output" >}}
{{< include file="static/workshop/getting-started/hello-world/00-pods-out-edited.yaml" language="txt"  options="linenos=table,linenostart=1,hl_lines=15 54-58" >}}
{{</ expand >}}


# :recycle: Cleanup

* To wipe out a pod and cleanup what you have done so far run:

```sh
kubectl delete pod hello-world
```
{{< expand "Terminal Output" >}}
```sh
pod "hello-world" deleted
```
{{< /expand >}}

* Verify nothing is running

```sh
kubectl get pod
```
{{< expand "Terminal Output" >}}
```sh
No resources found in default namespace.
```
{{< /expand >}}

:tada: Congratulation on wrapping up this introduction module ! You know know what a K8s pod is and how to run basic operations on it.

Don't be disappointed but you will most of the time not use a `Pod` directly :scream: (what you learned here is still really valuable no worries :sunglasses:)

In the next chapter we will introduce the `Deployment` object that is an higher abstraction object that controls `Pod` objects through `ReplicaSets`.

{{< button relref="01-deployments" class="info" size="large" >}}:point_right: Start using Deployments :rocket:{{< /button >}}